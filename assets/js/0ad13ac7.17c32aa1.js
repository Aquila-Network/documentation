"use strict";(self.webpackChunkaquila=self.webpackChunkaquila||[]).push([[481],{3905:function(e,t,n){n.d(t,{Zo:function(){return l},kt:function(){return m}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),d=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},l=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),p=d(n),m=o,h=p["".concat(s,".").concat(m)]||p[m]||u[m]||i;return n?a.createElement(h,r(r({ref:t},l),{},{components:n})):a.createElement(h,r({ref:t},l))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=p;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:o,r[1]=c;for(var d=2;d<i;d++)r[d]=n[d];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},951:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return c},contentTitle:function(){return s},metadata:function(){return d},toc:function(){return l},default:function(){return p}});var a=n(7462),o=n(3366),i=(n(7294),n(3905)),r=["components"],c={sidebar_position:4},s="Document",d={unversionedId:"db/concepts/Document",id:"db/concepts/Document",isDocsHomePage:!1,title:"Document",description:"Just like we define a database as a JSON object, a document in Aquila DB is another JSON object which complies to the database schema. A document ID is deterministic and is generated based on the content address (CID) of the document itself.",source:"@site/docs/db/concepts/Document.md",sourceDirName:"db/concepts",slug:"/db/concepts/Document",permalink:"/docs/db/concepts/Document",editUrl:"https://github.com/facebook/docusaurus/edit/main/website/docs/db/concepts/Document.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Creating a database",permalink:"/docs/db/concepts/database/Creating a database"},next:{title:"Vector search",permalink:"/docs/db/concepts/Vector search"}},l=[{value:"Document life-cycle",id:"document-life-cycle",children:[{value:"Creating a document",id:"creating-a-document",children:[],level:3},{value:"Deleting a document",id:"deleting-a-document",children:[],level:3},{value:"Updating a document",id:"updating-a-document",children:[],level:3}],level:2}],u={toc:l};function p(e){var t=e.components,n=(0,o.Z)(e,r);return(0,i.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"document"},"Document"),(0,i.kt)("p",null,"Just like we define a ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/Aquila-Network/specs/blob/main/adb/Creating%20a%20database.md"},"database")," as a JSON object, a document in Aquila DB is another JSON object which complies to the database schema. A document ID is deterministic and is generated based on the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/Aquila-Network/specs/blob/main/adb/Content%20Addressing.md"},"content address")," (CID) of the document itself."),(0,i.kt)("h2",{id:"document-life-cycle"},"Document life-cycle"),(0,i.kt)("p",null,"In Aquila DB a document can have any of the following two states - ",(0,i.kt)("inlineCode",{parentName:"p"},"created")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"deleted"),". The documents are immutable. Meaning, once a document is created, it cannot be modified (updated). This is because, once the content of a document is changed, the content ID should also be changed. Which thus becomes a new independent document that contradicts with the concept of update."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Note: Just like any other API, a document creation / deletion API expects the request to be signed by appropriate key from the wallet. This is to future proof data ownership and authorization wherever this document goes across Aquila Network. Please refer API section for more information.")),(0,i.kt)("h3",{id:"creating-a-document"},"Creating a document"),(0,i.kt)("p",null,"To create a document, construct a valid JSON object which follows the schema definition of database we are interested in. Document ID is deterministic (generated from the document content itself) thus is already known to both user and Aquila Network modules. So, the document ID is not required to be specified in the document itself. However for convenience, an Aquila DB instance should return the document ID upon successful creation."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"document_id = create_document_API(sign_message(JSON_document, database_name))\n")),(0,i.kt)("h3",{id:"deleting-a-document"},"Deleting a document"),(0,i.kt)("p",null,"Since a document is immutable, delete operation doesn't really delete a document from the database. Instead a document is ",(0,i.kt)("inlineCode",{parentName:"p"},'"flagged"')," as ",(0,i.kt)("inlineCode",{parentName:"p"},"deleted")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"not deleted"),". This simple concept has the following advantages:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"A document can be created and deleted at independent instances / geolocation across the network.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},'Maintains a reproducible state history for every document. This allows anyone ask questions such as "what was the snapshot of a specific database at a specific time?" without actually worrying about maintaining database snapshots.'))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"document_id = delete_document_API(sign_message(document_id, database_name))\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Flag operation")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"def delete_document_API (document_id, database_name):\n    document_reference = get_reference_to_document(document_id, database_name)\n    document_reference[__deleted__] = True\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Note: Independent, conflicting operations over document states are resolved ",(0,i.kt)("inlineCode",{parentName:"p"},"eventually"),", through ",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Eventual_consistency"},(0,i.kt)("inlineCode",{parentName:"a"},'"eventual consistency"'))," followed by ",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Eventual_consistency#Conflict_resolution"},(0,i.kt)("inlineCode",{parentName:"a"},'"conflict resolution"'))," strategies. It is important to note that, Aquila DB is not a real time database but an eventually consistent one with guaranteed state convergence.")),(0,i.kt)("h3",{id:"updating-a-document"},"Updating a document"),(0,i.kt)("p",null,"As mentioned earlier, there is no update operation available in Aquila DB to keep things very simple. An update operation is considered to be done at the user managed high-level layer by abstracting a sequence of a ",(0,i.kt)("inlineCode",{parentName:"p"},"delete")," followed by a ",(0,i.kt)("inlineCode",{parentName:"p"},"create")," operations. The user is supposed to map newly returned document ID to the old one accordingly at the higher level."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Reasoning behind decision: Since, Aquila Network will most probably be used with an already existing system which already use other mutable databases, this immutability strategy wouldn't make much issues to the large population with a better trade-off for simplicity and scalability.")))}p.isMDXComponent=!0}}]);