<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<title data-react-helmet="true">Aquila Replication Protocol | Aquila Network Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.aquila.network/docs/port/concepts/Aquila replication protocol/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Aquila Replication Protocol | Aquila Network Documentation"><meta data-react-helmet="true" name="description" content="Aquila Replication Protocol is adopted from the original Couch Replication Protocol. Below sections describe Aquila Replication Protocol in detail as a sequence of steps."><meta data-react-helmet="true" property="og:description" content="Aquila Replication Protocol is adopted from the original Couch Replication Protocol. Below sections describe Aquila Replication Protocol in detail as a sequence of steps."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://docs.aquila.network/docs/port/concepts/Aquila replication protocol/"><link data-react-helmet="true" rel="alternate" href="https://docs.aquila.network/docs/port/concepts/Aquila replication protocol/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.aquila.network/docs/port/concepts/Aquila replication protocol/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.f4e51aac.css">
<link rel="preload" href="/assets/js/runtime~main.14ea4d5b.js" as="script">
<link rel="preload" href="/assets/js/main.fc9e751f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Aquila Network Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo.png" alt="Aquila Network Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title"></b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/getstarted/">Get Started</a></div><div class="navbar__items navbar__items--right"><a href="https://medium.com/aquila-network" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/Aquila-Network" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/introduction/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/getstarted/">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/versions/">Supported Versions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/architecture/">Architecture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Aquila DB</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Aquila Hub</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Aquila Port</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/port/Aquila Port/">Intro: Aquila Port</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Concepts</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/port/concepts/Eventual consistency of events/">Eventual consistency of events</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/port/concepts/Aquila replication protocol/">Aquila Replication Protocol</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">APIs</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Aquila X</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Aquila Replication Protocol</h1></header><p>Aquila Replication Protocol is adopted from the original <a href="https://docs.couchdb.org/en/stable/replication/protocol.html" target="_blank" rel="noopener noreferrer">Couch Replication Protocol</a>. Below sections describe Aquila Replication Protocol in detail as a sequence of steps.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="replication-protocol-algorithm">Replication Protocol Algorithm<a aria-hidden="true" class="hash-link" href="#replication-protocol-algorithm" title="Direct link to heading">â€‹</a></h2><p>The Aquila Replication Protocol is not <em>magical</em>, but an agreement on usage of the public <a href="#">Aquila Port HTTP REST API</a> to enable Documents to be replicated from Source to Target.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="verify-peers">Verify peers<a aria-hidden="true" class="hash-link" href="#verify-peers" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27; Verify Peers:                                                             &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                                                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                404 Not Found   +--------------------------------+         &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       +----------------------- |     Check Target Existence     |         &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                        +--------------------------------+         &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                        |             GET /              |         &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                        +--------------------------------+         &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                          |                                        &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                          | 200 OK                                 &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                          v                                        &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                        +--------------------------------+         &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                        |     Check Target ID Changed    | ----+   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                        +--------------------------------+     |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                        |      Compare local storage     |     |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                        +--------------------------------+     |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                          |                                    |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                          | Target ID Not Found                |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       v                          v                                    |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   +-------+                    +--------------------------------+     |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   | Abort | &lt;----------------- |      Set Status &quot;inactive&quot;     |     |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   +-------+                    +--------------------------------+     |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                                                       |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                                       Target ID Found |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                                                       |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - | - +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - | - +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27; Verify Database:                                                      |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                  +------------------------------------+   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                  |                                        &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                  v                                        &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                +--------------------------------+         &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                |        Verify Databases        |         &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                +--------------------------------+         &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                                                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The Replicator MUST ensure that Target exist and node ID is valid by using <code>GET /</code> request.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="verify-databases">Verify Databases<a aria-hidden="true" class="hash-link" href="#verify-databases" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27; Verify Databases:                                                         &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                                                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                  Not Found     +--------------------------------+         &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       +----------------------- |    Check Source DB Existence   |         &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                        +--------------------------------+         &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                        |       Check local storage      |         &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                        +--------------------------------+         &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                          |                                        &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                          | 200 OK                                 &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                          v                                        &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                        +--------------------------------+         &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                        |    Check Target DB Existence   | ----+   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                        +--------------------------------+     |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                        |         HEAD /targetDB         |     |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                        +--------------------------------+     |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                          |                                    |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                          | 404 Not Found                      |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       v                          v                                    |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   +-------+    No              +--------------------------------+     |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   | Abort | &lt;----------------- |        Create Target DB?       |     |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   +-------+                    +--------------------------------+     |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       ^                          |                                    |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                          | Yes                                |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |                          v                                    |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       |        Failure         +--------------------------------+     |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;       +----------------------- |       Create Target DB         |     |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                +--------------------------------+     |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                |         PUT /targetDB          |     |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                +--------------------------------+     |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                  |                                    |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                  | 201 Created                 200 OK |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                  |                                    |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - -  | - - - - - - - - - - - - - - - - -  | - +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   |                                    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - -  | - - - - - - - - - - - - - - - - -  | - +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27; Get DB Information:              |                                    |   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                  +------------------------------------+   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                  |                                        &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                  v                                        &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                +--------------------------------+         &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                |    Get Target DB Information   |         &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                +--------------------------------+         &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                                                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The Replicator MUST ensure that both Source and Target DBs exist by using <code>HEAD /{db}</code> requests.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="get-db-information">Get DB information<a aria-hidden="true" class="hash-link" href="#get-db-information" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27; Get Target DB infromation:                                       &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                         +---------------------------+            &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                         | Check Target DB Existence |            &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                         +---------------------------+            &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                     |                            &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                     | 200 OK                     &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                     |                            &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - | - - - - - - - - - - - - - -+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - | - - - - - - - - - - - - - -+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27; Get DB Information:                 |                            &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                     |                            &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                 404                 v                            &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   +-------+  Not Found  +------------------------+               &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   | Abort | &lt;-----------|     GET /targetDB      |               &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   +-------+             +------------------------+               &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                     |                            &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                     | 200 OK                     &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                     |                            &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - | - - - - - - - - - - - - - -+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - | - - - - - - - - - - - - - -+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27; Find Common Ancestry:               |                            &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                     |                            &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                     v                            &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                         +-------------------------+              &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                         | Generate Replication ID |              &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                         +-------------------------+              &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                                                  &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -+</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The Replicator retrieves basic information from Target using <code>GET /{db}</code> request. </p><blockquote><p>Note: currently, any information about target DB that is retrieved is skipped without validation. 200 response is enough to verify that target peer is still up and running with healthy database.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_y2LR" id="find-common-ancestry">Find Common Ancestry<a aria-hidden="true" class="hash-link" href="#find-common-ancestry" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27; Get DB Information:                                                       &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                                                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                             +-------------------------------------------+ &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                             |           Get Target DB Information       | &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                             +-------------------------------------------+ &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                               |                                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - | - - - - - - - - - - - - - - - - - - - - - +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - | - - - - - - - - - - - - - - - - - - - - - +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27; Find Common Ancestry:         v                                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                             +-------------------------------------------+ &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                             |          Generate Replication ID          | &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                             +-------------------------------------------+ &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                               |                                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                               |                                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                               v                                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                             +-------------------------------------------+ &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                             |      Get Replication Log from Source      | &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                             +-------------------------------------------+ &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                               |                                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                               |                                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                               v                                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                             +-------------------------------------------+ &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                             |      Get Replication Log from Target      | &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                             +-------------------------------------------+ &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                             |    GET /targetDB/_local/replication-id    | &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                             +-------------------------------------------+ &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                               |                                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                               | 200 OK                                    &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                               | 404 Not Found                             &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                               v                                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                             +-------------------------------------------+ &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                             |          Compare Replication Logs         | &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                             +-------------------------------------------+ &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                               |                                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                               | Use latest common revision as start point &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                               |                                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - | - - - - - - - - - - - - - - - - - - - - - +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - | - - - - - - - - - - - - - - - - - - - - - +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27; Locate Changed Documents:     |                                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                               |                                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                               v                                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                             +-------------------------------------------+ &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                             |        Listen Source Changes Feed         | &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                             +-------------------------------------------+ &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                                                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h5 class="anchor anchorWithStickyNavbar_y2LR" id="generate-replication-id">Generate Replication ID<a aria-hidden="true" class="hash-link" href="#generate-replication-id" title="Direct link to heading">â€‹</a></h5><p>The Replication ID generation algorithm is implementation specific. Whatever algorithm is used it MUST uniquely identify the Replication process. Aquila Portâ€™s Replicator, for example, uses the following factors in generating a Replication ID:</p><ul><li>Source Aquila Port Node ID (already generated as UUID)</li><li>Target Aquila Port Node ID (already generated as UUID)</li><li>Database Name (unique for a specific schema)</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">replication_id = base64( sha( source_node_ID + target_node_ID + databaseName ) )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="locate-changed-documents">Locate Changed Documents<a aria-hidden="true" class="hash-link" href="#locate-changed-documents" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27; Find Common Ancestry:                                                     &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                                                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;             +------------------------------+                              &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;             |   Compare Replication Logs   |                              &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;             +------------------------------+                              &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                          |                                &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                          |                                &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - - -  |  - - - - - - - - - - - - - - - +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - - -  |  - - - - - - - - - - - - - - - +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27; Locate Changed Documents:                |                                &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                          |                                &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                          |                                &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                          v                                &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;            +-------------------------------+                              &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   +------&gt; |     Listen to Changes Feed    |                              &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |        +-------------------------------+      +-------------+         &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |        |     Read Batch of Changes     | ---&gt; | Replication |         &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |        +-------------------------------+      |  Completed  |         &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |                                      |        +-------------+         &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |                                      |                                &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   | No                                   |                                &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |                                      v                                &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |        +-------------------------------+                              &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |        |  Compare Documents Revisions  |                              &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |        +-------------------------------+                              &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |        |   POST /targetDB/_revs_diff   |                              &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |        +-------------------------------+                              &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |                                      |                                &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |                               200 OK |                                &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |                                      v                                &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |        +-------------------------------+                              &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   +------- |     Any Differences Found?    |                              &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;            +-------------------------------+                              &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                          |                                &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                      Yes |                                &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                          |                                &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - - -  |  - - - - - - - - - - - - - - - +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - - -  |  - - - - - - - - - - - - - - - +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27; Replicate Changes:                       |                                &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                          v                                &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;            +-------------------------------+                              &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;            |  Fetch Next Changed Document  |                              &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;            +-------------------------------+                              &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                                                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="replicate-changes">Replicate changes<a aria-hidden="true" class="hash-link" href="#replicate-changes" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27; Locate Changed Documents:                                                       &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                                                                 &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;               +-------------------------------------+                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;               |      Any Differences Found?         |                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;               +-------------------------------------+                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                                   |                             &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                                   |                             &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                                   |                             &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - - - - - - - - | - - - - - - - - - - - - - - +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - - - - - - - - | - - - - - - - - - - - - - - +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27; Replicate Changes:                                |                             &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                                   v                             &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;               +-------------------------------------+                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   +---------&gt; |     Fetch Next Changed Document     |                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |           +-------------------------------------+                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |             |                                                               &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |             |                                                               &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |             v                                                               &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |           +-------------------------------------+                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |           |     Put Document Into the Stack     |                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |           +-------------------------------------+                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |             |                                                               &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |             |                                                               &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |             v                                                               &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |     No    +-------------------------------------+                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   +---------- |           Stack is Full?            |                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |           +-------------------------------------+                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |             |                                                               &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |             | Yes                                                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |             |                                                               &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |             v                                                               &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |           +-------------------------------------+                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |           | Upload Stack of Documents to Target |                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |           +-------------------------------------+                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |           |      POST /targetDB/_bulk_docs      |                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |           +-------------------------------------+                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |             |                                                               &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |             | 201 Created                                                   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |             v                                                               &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |           +-------------------------------------+                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |           |          Ensure in Commit           |                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |           +-------------------------------------+                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |           |  POST /target/_ensure_full_commit   |                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |           +-------------------------------------+                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |             |                                                               &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |             | 201 Created                                                   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |             v                                                               &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |           +--------------------------------------+                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |           |     Record Replication Checkpoint    |                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |           +--------------------------------------+                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |           | Update source Replication Checkpoint |                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |           | PUT /targetDB/_local/replication-id  |                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |           +--------------------------------------+                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |             |                                                               &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |             | 201 Created                                                   &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |             v                                                               &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   |     No    +-------------------------------------+                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   +---------- | All Documents from Batch Processed? |                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;               +-------------------------------------+                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                                   |                             &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                               Yes |                             &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                                   |                             &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - - - - - - - - | - - - - - - - - - - - - - - +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - - - - - - - - | - - - - - - - - - - - - - - +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27; Locate Changed Documents:                         |                             &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                                   v                             &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;               +-------------------------------------+                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;               |               Sleep                 |                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;               +-------------------------------------+                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;               |       Listen to Changes Feed        |                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;               +-------------------------------------+                           &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;                                                                                 &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="notes">Notes<a aria-hidden="true" class="hash-link" href="#notes" title="Direct link to heading">â€‹</a></h3><p>Below are some noteworthy comments that will come in handy if you are familiar with Couch Replication Protocol.</p><ul><li>Couch Replication Protocol assumes the replication agent to be an independent daemon. In Aquila Port, replication daemon is part of the node itself. This replaces every source API calls in the original Couch Replication Protocol with local database calls as seen above in the Aquila Replication Protocol.</li><li>Aquila Port doesn&#x27;t implement two way replication (sync). Replication will only happen from source to target (push replication only). To simulate sync, each Aquila Port should perform push replication from both ends.</li><li>Aquila Replication Protocol doesn&#x27;t support document attachments (out of the scope).</li><li>Aquila Replication Protocol is not compatible with Couch Replication Protocol (as of now atleast).</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/main/website/docs/port/concepts/Aquila replication protocol.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/port/concepts/Eventual consistency of events/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Eventual consistency of events</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/port/apis/python/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Python 3<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#replication-protocol-algorithm" class="table-of-contents__link toc-highlight">Replication Protocol Algorithm</a><ul><li><a href="#verify-peers" class="table-of-contents__link toc-highlight">Verify peers</a></li><li><a href="#verify-databases" class="table-of-contents__link toc-highlight">Verify Databases</a></li><li><a href="#get-db-information" class="table-of-contents__link toc-highlight">Get DB information</a></li><li><a href="#find-common-ancestry" class="table-of-contents__link toc-highlight">Find Common Ancestry</a></li><li><a href="#locate-changed-documents" class="table-of-contents__link toc-highlight">Locate Changed Documents</a></li><li><a href="#replicate-changes" class="table-of-contents__link toc-highlight">Replicate changes</a></li><li><a href="#notes" class="table-of-contents__link toc-highlight">Notes</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/">Get Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://discord.gg/5YP7zHS" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://medium.com/aquila-network" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/Aquila-Network" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Aquila Network.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.14ea4d5b.js"></script>
<script src="/assets/js/main.fc9e751f.js"></script>
</body>
</html>